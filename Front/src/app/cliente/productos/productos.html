<!-- Header Productos -->
<section class="prd-hero">
	<div class="container">
		<span class="badge">Catálogo</span>
		<h1>Nuestros Productos</h1>
		<p class="subtitle">Explora cuyes vivos de razas certificadas y carne de cuy premium lista para cocinar.</p>
	</div>
</section>

<!-- Búsqueda y Filtros -->
<section class="prd-section">
	<div class="container">
		<!-- Barra de búsqueda -->
		<div class="search-bar">
			<input 
				type="text" 
				[(ngModel)]="searchTerm" 
				(input)="aplicarFiltros()"
				placeholder="Buscar productos por nombre, tipo o descripción..."
				class="search-input"
			>
			<button class="search-btn">
				<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
				</svg>
			</button>
		</div>

		<!-- Filtros funcionales -->
		<div class="filters">
			<div class="filter">
				<label>Categoría</label>
				<select [(ngModel)]="selectedCategoria" (change)="aplicarFiltros()" class="select">
					@for (cat of categorias; track cat) {
						<option [value]="cat">{{cat}}</option>
					}
				</select>
			</div>
			<div class="filter">
				<label>Raza</label>
				<select [(ngModel)]="selectedRaza" (change)="aplicarFiltros()" class="select">
					@for (raza of razas; track raza) {
						<option [value]="raza">{{raza}}</option>
					}
				</select>
			</div>
			<div class="filter">
				<label>Precio</label>
				<select [(ngModel)]="selectedPrecio" (change)="aplicarFiltros()" class="select">
					@for (rango of rangosPrecios; track rango.label) {
						<option [value]="rango.label">{{rango.label}}</option>
					}
				</select>
			</div>
			<div class="filter">
				<label>Ordenar por</label>
				<select [(ngModel)]="selectedOrden" (change)="aplicarFiltros()" class="select">
					<option value="destacado">Destacado</option>
					<option value="precio-asc">Precio: Menor a Mayor</option>
					<option value="precio-desc">Precio: Mayor a Menor</option>
					<option value="nombre">Nombre A-Z</option>
				</select>
			</div>
			<button class="btn outline" (click)="limpiarFiltros()">Limpiar filtros</button>
		</div>

		<!-- Resultados -->
		<div class="results-info">
			<p>Mostrando {{productosPaginados.length}} de {{totalItems}} productos</p>
		</div>

		<!-- Grid de productos dinámico -->
		@if (productosPaginados.length > 0) {
			<div class="grid">
				@for (producto of productosPaginados; track producto.id) {
					<div class="p-card" style="cursor: pointer;">
						<div class="img" [style.background-image]="'url(' + producto.imagenes[0] + ')'" (click)="viewProductDetail(producto.id)">
							<button 
								class="wishlist-btn" 
								[class.active]="isInWishlist(producto.id)"
								(click)="toggleWishlist(producto.id); $event.stopPropagation()"
								[title]="isInWishlist(producto.id) ? 'Quitar de favoritos' : 'Agregar a favoritos'"
							>
								@if (isInWishlist(producto.id)) {
									<svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
										<path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
									</svg>
								} @else {
									<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
									</svg>
								}
							</button>
						</div>
						<div class="body" (click)="viewProductDetail(producto.id)">
							<h4>{{producto.nombre}}</h4>
							<p class="muted">{{producto.raza}} • {{producto.peso}}</p>
							<div class="chips">
								<span class="chip">{{producto.tipo}}</span>
								@if (producto.certificado) {
									<span class="chip">Certificado</span>
								}
							</div>
							<div class="price">
								<strong>S/ {{producto.precio.toFixed(2)}}</strong>
							</div>
						</div>
					</div>
				}
			</div>
		} @else {
			<app-estado-vacio
				icon="search"
				title="No se encontraron productos"
				message="Intenta ajustar los filtros o realiza una nueva búsqueda"
				actionText="Limpiar filtros"
				(onAction)="limpiarFiltros()"
			/>
		}

		<!-- Paginación -->
		@if (totalPages > 1) {
			<div class="pagination-wrapper">
				<app-paginacion
					[currentPage]="currentPage"
					[totalPages]="totalPages"
					[totalItems]="totalItems"
					[itemsPerPage]="itemsPerPage"
					(pageChange)="onPageChange($event)"
				/>
			</div>
		}
	</div>
</section>
