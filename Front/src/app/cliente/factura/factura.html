<div class="invoice-container">
  <!-- Botones de acción (no imprimir) -->
  <div class="action-buttons no-print">
    <button class="btn btn-outline" (click)="goBack()">
      <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="19" y1="12" x2="5" y2="12"/>
        <polyline points="12 19 5 12 12 5"/>
      </svg>
      Volver
    </button>
    <button class="btn btn-secondary" (click)="downloadPDF()">
      <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="7 10 12 15 17 10"></polyline>
        <line x1="12" y1="15" x2="12" y2="3"></line>
      </svg>
      Descargar PDF
    </button>
    <button class="btn btn-primary" (click)="print()">
      <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="6 9 6 2 18 2 18 9"></polyline>
        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
        <rect x="6" y="14" width="12" height="8"></rect>
      </svg>
      Imprimir
    </button>
  </div>

  @if (cargando) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Cargando factura...</p>
    </div>
  } @else if (pedido) {
  <!-- Factura -->
  <div class="invoice">
    <!-- Header -->
    <div class="invoice-header">
      <div class="company-info">
        <h1>{{company.name}}</h1>
        <p><strong>RUC:</strong> {{company.ruc}}</p>
        <p>{{company.address}}</p>
        <p>{{company.phone}} | {{company.email}}</p>
      </div>
      <div class="invoice-info">
        <h2 class="invoice-title">FACTURA ELECTRÓNICA</h2>
        <p><strong>N°:</strong> {{pedido.numeroPedido}}</p>
        <p><strong>Fecha:</strong> {{pedido.fechaPedido | date:'dd/MM/yyyy HH:mm'}}</p>
        <p><strong>Estado:</strong> {{pedido.estado}}</p>
      </div>
    </div>

    <div class="divider"></div>

    <!-- Cliente -->
    <div class="client-info">
      <h3>Datos del Cliente</h3>
      <div class="info-grid">
        <div>
          <p><strong>Nombre:</strong> {{pedido.usuarioNombre}}</p>
          <p><strong>Email:</strong> {{pedido.usuarioEmail}}</p>
        </div>
      </div>
      @if (pedido.direccionEnvio) {
        <p><strong>Dirección de envío:</strong> {{pedido.direccionEnvio}}</p>
      }
    </div>

    <div class="divider"></div>

    <!-- Productos -->
    <div class="products-table">
      <table>
        <thead>
          <tr>
            <th>Código</th>
            <th>Descripción</th>
            <th>Cantidad</th>
            <th>P. Unitario</th>
            <th>Subtotal</th>
          </tr>
        </thead>
        <tbody>
          @for (item of pedido.items; track item.id) {
          <tr>
            <td>PROD-{{item.productoId}}</td>
            <td>{{item.productoNombre}}</td>
            <td class="center">{{item.cantidad}}</td>
            <td class="right">S/ {{item.precioUnitario.toFixed(2)}}</td>
            <td class="right">S/ {{item.subtotal.toFixed(2)}}</td>
          </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Totales -->
    <div class="invoice-totals">
      <div class="totals-row">
        <span>Subtotal:</span>
        <span>S/ {{pedido.subtotal.toFixed(2)}}</span>
      </div>
      @if (pedido.descuento > 0) {
      <div class="totals-row discount">
        <span>Descuento:</span>
        <span>-S/ {{pedido.descuento.toFixed(2)}}</span>
      </div>
      }
      <div class="totals-row">
        <span>Envío:</span>
        <span>S/ {{pedido.costoEnvio.toFixed(2)}}</span>
      </div>
      <div class="totals-row">
        <span>IGV (18%):</span>
        <span>S/ {{(pedido.total * 0.18 / 1.18).toFixed(2)}}</span>
      </div>
      <div class="divider-small"></div>
      <div class="totals-row total">
        <span>TOTAL:</span>
        <span>S/ {{pedido.total.toFixed(2)}}</span>
      </div>
    </div>

    <!-- Footer -->
    <div class="invoice-footer">
      <div class="payment-info">
        <p><strong>Método de pago:</strong> {{pedido.metodoPago}}</p>
      </div>
      
      <div class="qr-section">
        <div class="qr-placeholder">
          <svg viewBox="0 0 24 24" width="80" height="80" fill="currentColor">
            <rect x="3" y="3" width="7" height="7"/>
            <rect x="3" y="14" width="7" height="7"/>
            <rect x="14" y="3" width="7" height="7"/>
            <rect x="14" y="14" width="7" height="7"/>
          </svg>
        </div>
        <p class="qr-text">Código QR de verificación</p>
      </div>

      <div class="notes">
        <p><strong>Notas:</strong></p>
        <p>Gracias por tu compra. Para cualquier consulta, contáctanos al {{company.phone}}.</p>
        <p class="small-text">Este documento es una representación impresa de la factura electrónica.</p>
      </div>
    </div>
  </div>
  }
</div>
