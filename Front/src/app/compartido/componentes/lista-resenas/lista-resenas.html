<div class="review-list">
  <!-- Summary Section -->
  <div class="reviews-summary">
    <div class="summary-left">
      <div class="average-rating">
        <span class="rating-number">{{ averageRating.toFixed(1) }}</span>
        <div class="rating-stars">
          <app-calificacion [calificacion]="averageRating" [editable]="false"></app-calificacion>
        </div>
        <span class="total-reviews">{{ totalReviews }} reseñas</span>
      </div>
    </div>

    <div class="summary-right">
      <div class="rating-bars">
        @for (star of [5, 4, 3, 2, 1]; track star) {
          <div class="rating-bar-row">
            <span class="star-label">{{ star }}</span>
            <svg class="star-icon" width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
            <div class="bar-container">
              <div class="bar-fill" [style.width.%]="getRatingPercentage(star)"></div>
            </div>
            <span class="bar-count">{{ ratingDistribution[star] || 0 }}</span>
          </div>
        }
      </div>
    </div>
  </div>

  <!-- Filters and Sort -->
  <div class="review-controls">
    <div class="filter-buttons">
      <button 
        class="filter-btn" 
        [class.active]="filterRating === 0"
        (click)="onFilterChange(0)"
      >
        Todas
      </button>
      @for (star of [5, 4, 3, 2, 1]; track star) {
        <button 
          class="filter-btn" 
          [class.active]="filterRating === star"
          (click)="onFilterChange(star)"
        >
          {{ star }} ⭐
        </button>
      }
    </div>

    <div class="sort-select">
      <label for="sort">Ordenar por:</label>
      <select 
        id="sort" 
        [value]="sortBy"
        (change)="onSortChange($any($event.target).value)"
      >
        <option value="recent">Más recientes</option>
        <option value="helpful">Más útiles</option>
        <option value="highest">Mejor valoradas</option>
        <option value="lowest">Peor valoradas</option>
      </select>
    </div>
  </div>

  <!-- Reviews List -->
  <div class="reviews-container">
    @if (filteredReviews.length === 0) {
      <div class="no-reviews">
        <svg class="icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
        </svg>
        <p>No hay reseñas {{ filterRating > 0 ? 'con esta calificación' : 'aún' }}</p>
        @if (filterRating > 0) {
          <button class="btn-clear-filter" (click)="onFilterChange(0)">
            Ver todas las reseñas
          </button>
        }
      </div>
    } @else {
      @for (review of filteredReviews; track review.id) {
        <div class="review-card">
          <div class="review-header">
            <div class="user-info">
              <div class="user-avatar">
                {{ review.userName.charAt(0).toUpperCase() }}
              </div>
              <div>
                <div class="user-name">
                  {{ review.userName }}
                  @if (review.verified) {
                    <span class="verified-badge" title="Compra verificada">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
                      </svg>
                    </span>
                  }
                </div>
                <div class="review-date">{{ formatDate(review.date) }}</div>
              </div>
            </div>
            <app-calificacion [calificacion]="review.rating" [editable]="false"></app-calificacion>
          </div>

          <div class="review-content">
            <h4 class="review-title">{{ review.title }}</h4>
            <p class="review-comment">{{ review.comment }}</p>
          </div>

          <div class="review-footer">
            <button 
              class="helpful-btn"
              (click)="markAsHelpful(review.id)"
            >
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/>
              </svg>
              Útil ({{ review.helpful }})
            </button>
          </div>
        </div>
      }
    }
  </div>
</div>
